SELECT/*+PARALLEL(60)*/ COUNT(1) 批处理笔数
  FROM (SELECT TCP.POLICY_CODE,
               TCBP.BUSI_PROD_CODE,
               TCP.IS_PAUSE,
               TCP.PAUSE_DATE
          FROM DEV_PAS.T_CONTRACT_PRODUCT@BINGXING_168_15   TCP,
               DEV_PAS.T_CONTRACT_BUSI_PROD@BINGXING_168_15 TCBP
         WHERE TCBP.BUSI_ITEM_ID = TCP.BUSI_ITEM_ID
           AND (TCBP.BUSI_PROD_CODE = '00907000' OR
               TCBP.BUSI_PROD_CODE = '00909000')
           AND TCP.PAUSE_DATE - 60 = TRUNC(SYSDATE)-1
           AND TCP.ORGAN_CODE LIKE '8647%'
           AND TCP.IS_PAUSE = '1');
           
SELECT/*+PARALLEL(60)*/ COUNT(A.POLNO) AS 保单险种暂缓件数
  FROM LIS.LCPOL A
 INNER JOIN LIS.LCCONTSTATE C
    ON A.POLNO = C.POLNO
 WHERE A.RISKCODE IN ('00907000' ， '00909000')
   AND C.STATETYPE = 'DelayPrem'
   AND C.STATE = '1'
   AND C.STARTDATE = TRUNC(SYSDATE)-1
   AND A.MANAGECOM LIKE '8647%';

/************************************************************ 明细 *****************************************************/
--CREATE TABLE TMP_NCS_1019  AS
DELETE FROM TMP_NCS_1019;
COMMIT;
INSERT INTO TMP_NCS_1019
SELECT /*+PARALLEL(60)*/TCP.POLICY_CODE, --保单号
       TCBP.BUSI_PROD_CODE, --产品编码
       TCP.IS_PAUSE, --暂缓标志
       TCP.PAUSE_DATE --暂缓结束日期
  FROM DEV_PAS.T_CONTRACT_PRODUCT@BINGXING_168_15   TCP,
       DEV_PAS.T_CONTRACT_BUSI_PROD@BINGXING_168_15 TCBP
 WHERE TCBP.BUSI_ITEM_ID = TCP.BUSI_ITEM_ID
   AND (TCBP.BUSI_PROD_CODE = '00907000' OR
       TCBP.BUSI_PROD_CODE = '00909000')
   AND TCP.PAUSE_DATE - 60 = TRUNC(SYSDATE)-1
   AND TCP.ORGAN_CODE LIKE '8647%'
   AND TCP.IS_PAUSE = '1';
COMMIT;

--CREATE TABLE  TMP_LIS_1019  AS
DELETE FROM TMP_LIS_1019;
COMMIT;
INSERT INTO TMP_LIS_1019
SELECT/*+PARALLEL(60)*/ A.CONTNO,
       A.RISKCODE,
       DECODE(C.ENDDATE, NULL, 0, 1) AS IS_PAUSE,
       C.ENDDATE
  FROM LIS.LCPOL A
 INNER JOIN LIS.LCCONTSTATE C
    ON A.POLNO = C.POLNO
 WHERE A.RISKCODE IN ('00907000' ， '00909000')
   AND C.STATETYPE = 'DelayPrem'
   AND C.STATE = '1'
   AND C.STARTDATE = TRUNC(SYSDATE)-1
   AND A.MANAGECOM LIKE '8647%';
   
SELECT/*+PARALLEL(60)*/ DECODE(T1.CONTNO, NULL, T2.POLICY_CODE, T1.CONTNO) AS 保单号,
       DECODE(T1.RISKCODE, NULL, T2.BUSI_PROD_CODE, T1.RISKCODE) AS 产品编码,
       T1.IS_PAUSE AS 暂缓标志,
       T1.ENDDATE AS 暂缓结束日期,
       T2.IS_PAUSE  AS 暂缓标志,
       T2.PAUSE_DATE AS 暂缓结束日期,
       DECODE(TRIM(T1.IS_PAUSE), TRIM(T2.IS_PAUSE), 'Y', 'N') AS 差异
  FROM TMP_LIS_1019 T1
  FULL JOIN TMP_NCS_1019 T2
    ON TRIM(T1.CONTNO) = TRIM(T2.POLICY_CODE)
   AND TRIM(T1.RISKCODE) = TRIM(T2.BUSI_PROD_CODE)
 ORDER BY T2.POLICY_CODE;


